<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>pyBBN v0.9.0: evolution.py</title>
  <link rel="stylesheet" href="./pyccoon.css">
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
  </script>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div id='container' >
  <div id="footer">
    <span id="project-name">
        <a class="btn" href="./index.html">pyBBN v0.9.0</a>
    </span>
    <a class="btn" class="source source-1" href="#top">Back to top</a>
    <div id="jump_to" class="btn">
    Contents
    <div id="jump_wrapper">
      <div id="jump_page">
          <a class="source source-2" href="#universe"> Universe</a>
          <a class="source source-2" href="#main-computing-routine"> Main computing routine</a>
          <a class="source source-3" href="#1.-update-particles-state"> 1. Update particles state</a>
          <a class="source source-3" href="#2.-initialize-non-equilibrium-interactions"> 2. Initialize non-equilibrium interactions</a>
          <a class="source source-3" href="#3.-calculate-collision-integrals"> 3. Calculate collision integrals </a>
          <a class="source source-3" href="#4.-update-particles-distributions"> 4. Update particles distributions </a>
          <a class="source source-3" href="#5.-calculate-temperature-equation-terms"> 5. Calculate temperature equation terms </a>
          <a class="source source-2" href="#temperature-equation-integrand"> Temperature equation integrand</a>
      </div>
    </div>
    </div>
    <div class="generation-time">
        Generated at
        <code>2015-06-07 02:03</code>
        by a diligent
        <a target="_blank" href="http://ckald.github.io/pyccoon/" title="Pyccoon: side-to-side documentation generator">
            <img id="pyccoon-icon" src="./pyccoon_icon.svg" alt="Pyccoon: side-to-side documentation generator" />pyccoon</a>
    </div>
  </div>
  <a id="top"></a>
  <div class='section'>
    <div class='docs nav'>
      <nav id="breadcrumbs">/ <a href="evolution.py.html/../index.html">.</a> / evolution.py</nav>
      <ul id="children"></ul>
    </div>
  </div>
  <div id="everything" class='clearall'>
    <div id="background"></div>
    <div class='section'>
    <a id="section-0" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-0'>#</a>
          </div>
          <p>-<em>- coding: utf-8 -</em>-</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>

<span class="kn">from</span> <span class="nn">common</span> <span class="kn">import</span> <span class="n">UNITS</span><span class="p">,</span> <span class="n">Params</span><span class="p">,</span> <span class="n">Grid</span><span class="p">,</span> <span class="n">CONST</span><span class="p">,</span> <span class="n">integrators</span><span class="p">,</span> <span class="n">parallelization</span><span class="p">,</span> <span class="n">utils</span>

<span class="kn">import</span> <span class="nn">kawano</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-1" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-1'>#</a>
          </div>
          <h2><a id="universe" class="header-anchor" href="#universe"> Universe</a></h2>
<p>The master object that governs the calculation. </p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="k">class</span> <span class="nc">Universe</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-2" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-2'>#</a>
          </div>
          <p>System state is rendered to the log file each <code>log_freq</code> steps</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="n">log_freq</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">clock_start</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">particles</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">interactions</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">kawano</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">kawano_log</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">oscillations</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;aT&#39;</span><span class="p">,</span> <span class="s">&#39;T&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="s">&#39;rho&#39;</span><span class="p">,</span> <span class="s">&#39;fraction&#39;</span><span class="p">))</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-3" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-3'>#</a>
          </div>
          <p><span class="pydoc pydoc-param"><span>param</span> <code>particles</code></span> Set of <code>particle.Particle</code> to model
<span class="pydoc pydoc-param"><span>param</span> <code>interactions</code></span> Set of <code>interaction.Interaction</code> - quantum interactions between particle species
<span class="pydoc pydoc-param"><span>param</span> <code>folder</code></span> Log file path (current <code>datetime</code> by default)</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s">&#39;logs&#39;</span><span class="p">,</span> <span class="n">plotting</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">particles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clock_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">Params</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span> <span class="k">else</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">Grid</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">grid</span> <span class="k">else</span> <span class="n">grid</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">getboolenv</span><span class="p">(</span><span class="s">&quot;PLOT&quot;</span><span class="p">,</span> <span class="n">plotting</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">plotting</span> <span class="kn">import</span> <span class="n">Plotting</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span> <span class="o">=</span> <span class="n">Plotting</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_log</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-4" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-4'>#</a>
          </div>
          <p>Controls parallelization of the collision integrals calculations</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">PARALLELIZE</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getboolenv</span><span class="p">(</span><span class="s">&quot;PARALLELIZE&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fraction</span> <span class="o">=</span> <span class="mi">0</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-5" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-5'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">init_kawano</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datafile</span><span class="o">=</span><span class="s">&#39;s4.dat&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kawano</span><span class="o">.</span><span class="n">init_kawano</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kawano_log</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">datafile</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kawano_log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kawano</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kawano</span> <span class="o">=</span> <span class="n">kawano</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kawano_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kawano</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-6" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-6'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">init_oscillations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">particles</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oscillations</span> <span class="o">=</span> <span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">particles</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-7" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-7'>#</a>
          </div>
          <h2><a id="main-computing-routine" class="header-anchor" href="#main-computing-routine"> Main computing routine</a></h2>
<p>Modeling is carried in steps of scale factor, starting from the initial conditions defined by a single parameter: the initial temperature.</p>
<p>Initial temperature (e.g. 10 MeV) corresponds to a point in the history of the Universe long before then BBN. Then most particle species are in the thermodynamical equilibrium.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">evolve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">particle</span>

        <span class="k">for</span> <span class="n">interaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">interaction</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_energy_density</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_params</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">T</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">T_final</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">make_step</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Keyboard interrupt!&quot;</span>
                <span class="k">break</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">particle</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kawano</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kawano</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kawano_data</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kawano_log</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">kawano_log</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">print</span> <span class="n">kawano</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">kawano_data</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s">&quot;kawano.pickle&quot;</span><span class="p">))</span>

        <span class="k">print</span> <span class="s">&quot;Data saved to file {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARALLELIZE</span><span class="p">:</span>
            <span class="n">parallelization</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s">&quot;evolution.pickle&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-8" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-8'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">make_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dy</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integrand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">aT</span><span class="p">)</span>

        <span class="n">order</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;fraction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">order</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fraction</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">aT</span> <span class="o">+=</span>\
            <span class="n">integrators</span><span class="o">.</span><span class="n">adams_bashforth_correction</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dx</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_energy_density</span><span class="p">())</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-9" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-9'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">add_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">particles</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="n">particles</span><span class="p">:</span>
            <span class="n">particle</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">particles</span> <span class="o">+=</span> <span class="n">particles</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-10" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-10'>#</a>
          </div>
          <h3><a id="1.-update-particles-state" class="header-anchor" href="#1.-update-particles-state"> 1. Update particles state</a></h3>
<p>Update particle species distribution functions, check for regime switching, update precalculated variables like energy density and pressure. </p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">update_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">:</span>
            <span class="n">particle</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-11" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-11'>#</a>
          </div>
          <h3><a id="2.-initialize-non-equilibrium-interactions" class="header-anchor" href="#2.-initialize-non-equilibrium-interactions"> 2. Initialize non-equilibrium interactions</a></h3>
<p>Non-equilibrium interactions of different particle species are treated by a numerical integration of the Boltzmann equation for distribution functions in the expanding space-time.</p>
<p>Depending on the regime of the particle species involved and cosmological parameters, each <code>Interaction</code> object populates <code>Particle.collision_integrals</code> array with currently active <code>Integral</code> objects.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">init_interactions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">interaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">:</span>
            <span class="n">interaction</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-12" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-12'>#</a>
          </div>
          <h3><a id="3.-calculate-collision-integrals" class="header-anchor" href="#3.-calculate-collision-integrals"> 3. Calculate collision integrals </a></h3>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">calculate_collisions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">particles</span> <span class="o">=</span> <span class="p">[</span><span class="n">particle</span> <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span> <span class="k">if</span> <span class="n">particle</span><span class="o">.</span><span class="n">collision_integrals</span><span class="p">]</span>

        <span class="k">with</span> <span class="n">utils</span><span class="o">.</span><span class="n">printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARALLELIZE</span><span class="p">:</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-13" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-13'>#</a>
          </div>
          <p>Send the tasks</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>                <span class="n">maps</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="n">particle</span><span class="p">,</span>
                     <span class="n">parallelization</span><span class="o">.</span><span class="n">poolmap</span><span class="p">(</span><span class="n">particle</span><span class="p">,</span> <span class="s">&#39;calculate_collision_integral&#39;</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">TEMPLATE</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="n">particles</span>
                <span class="p">]</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-14" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-14'>#</a>
          </div>
          <p>Collect results</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>                <span class="k">for</span> <span class="n">particle</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">maps</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">utils</span><span class="o">.</span><span class="n">benchmark</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="s">&quot;I(&quot;</span> <span class="o">+</span> <span class="n">particle</span><span class="o">.</span><span class="n">symbol</span> <span class="o">+</span> <span class="s">&quot;) = &quot;</span>
                                         <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">particle</span><span class="o">.</span><span class="n">collision_integral</span><span class="p">)):</span>
                        <span class="n">particle</span><span class="o">.</span><span class="n">collision_integral</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-15" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-15'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="n">particles</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">utils</span><span class="o">.</span><span class="n">benchmark</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="s">&quot;I(&quot;</span> <span class="o">+</span> <span class="n">particle</span><span class="o">.</span><span class="n">symbol</span> <span class="o">+</span> <span class="s">&quot;) = &quot;</span>
                                         <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">particle</span><span class="o">.</span><span class="n">collision_integral</span><span class="p">)):</span>
                        <span class="n">particle</span><span class="o">.</span><span class="n">collision_integral</span> <span class="o">=</span> <span class="n">particle</span><span class="o">.</span><span class="n">integrate_collisions</span><span class="p">()</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-16" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-16'>#</a>
          </div>
          <h3><a id="4.-update-particles-distributions" class="header-anchor" href="#4.-update-particles-distributions"> 4. Update particles distributions </a></h3>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">update_distributions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oscillations</span><span class="p">:</span>
            <span class="n">pattern</span><span class="p">,</span> <span class="n">particles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oscillations</span>

            <span class="n">integrals</span> <span class="o">=</span> <span class="p">{</span><span class="n">A</span><span class="o">.</span><span class="n">flavour</span><span class="p">:</span> <span class="n">A</span><span class="o">.</span><span class="n">collision_integral</span> <span class="k">for</span> <span class="n">A</span> <span class="ow">in</span> <span class="n">particles</span><span class="p">}</span>

            <span class="k">for</span> <span class="n">A</span> <span class="ow">in</span> <span class="n">particles</span><span class="p">:</span>
                <span class="n">A</span><span class="o">.</span><span class="n">collision_integral</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pattern</span><span class="p">[(</span><span class="n">A</span><span class="o">.</span><span class="n">flavour</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">flavour</span><span class="p">)]</span> <span class="o">*</span> <span class="n">integrals</span><span class="p">[</span><span class="n">B</span><span class="o">.</span><span class="n">flavour</span><span class="p">]</span>
                                           <span class="k">for</span> <span class="n">B</span> <span class="ow">in</span> <span class="n">particles</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">:</span>
            <span class="n">particle</span><span class="o">.</span><span class="n">update_distribution</span><span class="p">()</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-17" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-17'>#</a>
          </div>
          <h3><a id="5.-calculate-temperature-equation-terms" class="header-anchor" href="#5.-calculate-temperature-equation-terms"> 5. Calculate temperature equation terms </a></h3>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">calculate_temperature_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">numerator</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">:</span>
            <span class="n">numerator</span> <span class="o">+=</span> <span class="n">particle</span><span class="o">.</span><span class="n">numerator</span><span class="p">()</span>
            <span class="n">denominator</span> <span class="o">+=</span> <span class="n">particle</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-18" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-18'>#</a>
          </div>
          <h2><a id="temperature-equation-integrand" class="header-anchor" href="#temperature-equation-integrand"> Temperature equation integrand</a></h2>
<p>Master equation for the temperature looks like</p>
<p>\begin{equation}
       \frac{d (aT)}{dx} = \frac{\sum_i{N_i}}{\sum_i{D_i}}
   \end{equation}</p>
<p>Where $N_i$ and $D_i$ represent contributions from different particle species.</p>
<p>See definitions for different regimes:
     * <a href="particles/RadiationParticle.py.html#master-equation-terms">Radiation</a>
     * <a href="particles/IntermediateParticle.py.html#master-equation-terms">Intermediate</a>
     * <a href="particles/DustParticle.py.html#master-equation-terms">Dust</a>
     * <a href="particles/NonEqParticle.py.html#master-equation-terms">Non-equilibrium</a></p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">integrand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-19" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-19'>#</a>
          </div>
          <p>1. Update particles states</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">update_particles</span><span class="p">()</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-20" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-20'>#</a>
          </div>
          <p>2. Initialize non-equilibrium interactions</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">init_interactions</span><span class="p">()</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-21" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-21'>#</a>
          </div>
          <p>3. Calculate collision integrals</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_collisions</span><span class="p">()</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-22" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-22'>#</a>
          </div>
          <p>4. Update particles distributions</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">update_distributions</span><span class="p">()</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-23" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-23'>#</a>
          </div>
          <p>5. Calculate temperature equation terms</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_temperature_terms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-24" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-24'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">save_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s">&#39;aT&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">aT</span><span class="p">,</span>
            <span class="s">&#39;T&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
            <span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">a</span><span class="p">,</span>
            <span class="s">&#39;x&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="s">&#39;rho&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span>
            <span class="s">&#39;N_eff&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">N_eff</span><span class="p">,</span>
            <span class="s">&#39;t&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
            <span class="s">&#39;fraction&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction</span>
        <span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-25" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-25'>#</a>
          </div>
          <p>Save current Universe parameters into the data arrays or output files </p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_params</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kawano</span><span class="p">:</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-26" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-26'>#</a>
          </div>
          <p>t[s]         x    Tg[10^9K]   dTg/dt[10^9K/s] rho_tot[g cm^-3]     H[s^-1]
 n nue-&gt;p e  p e-&gt;n nue  n-&gt;p e nue  p e nue-&gt;n  n e-&gt;p nue  p nue-&gt;n e</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>            <span class="n">rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kawano</span><span class="o">.</span><span class="n">baryonic_rates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>

            <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kawano</span><span class="o">.</span><span class="n">heading</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">t</span> <span class="o">/</span> <span class="n">UNITS</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kawano</span><span class="o">.</span><span class="n">heading</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">UNITS</span><span class="o">.</span><span class="n">MeV</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kawano</span><span class="o">.</span><span class="n">heading</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">UNITS</span><span class="o">.</span><span class="n">MeV</span> <span class="o">*</span> <span class="n">CONST</span><span class="o">.</span><span class="n">MeV_to_10_9K</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kawano</span><span class="o">.</span><span class="n">heading</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">UNITS</span><span class="o">.</span><span class="n">MeV</span>
                <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">UNITS</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="n">CONST</span><span class="o">.</span><span class="n">MeV_to_10_9K</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kawano</span><span class="o">.</span><span class="n">heading</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">rho</span> <span class="o">/</span> <span class="n">UNITS</span><span class="o">.</span><span class="n">MeV</span><span class="o">**</span><span class="mi">4</span> <span class="o">*</span> <span class="n">CONST</span><span class="o">.</span><span class="n">MeV4_to_g_cm_3</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kawano</span><span class="o">.</span><span class="n">heading</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">H</span> <span class="o">*</span> <span class="n">UNITS</span><span class="o">.</span><span class="n">s</span>
            <span class="p">}</span>
            <span class="n">row</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">kawano</span><span class="o">.</span><span class="n">heading</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">rate</span> <span class="o">/</span> <span class="n">UNITS</span><span class="o">.</span><span class="n">MeV</span><span class="o">**</span><span class="mi">5</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rates</span><span class="p">,</span> <span class="mi">6</span><span class="p">)})</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">kawano_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kawano_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">log_entry</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;{:e}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kawano_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">print</span> <span class="s">&quot;KAWANO&quot;</span><span class="p">,</span> <span class="n">log_entry</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kawano_log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">log_entry</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-27" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-27'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">init_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s">&#39;log.txt&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">Logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-28" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-28'>#</a>
          </div>
          <p>Runtime log output </p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-29" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-29'>#</a>
          </div>
          <p>Print parameters every now and then</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="s">&#39;[{clock}] #{step}</span><span class="se">\t</span><span class="s">t = {t:e}</span><span class="se">\t</span><span class="s">aT = {aT:e}</span><span class="se">\t</span><span class="s">T = {T:e}</span><span class="se">\t</span><span class="s">a = {a:e}&#39;</span>
                   <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clock</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock_start</span><span class="p">))),</span>
                           <span class="n">step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
                           <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">t</span> <span class="o">/</span> <span class="n">UNITS</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
                           <span class="n">aT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">aT</span> <span class="o">/</span> <span class="n">UNITS</span><span class="o">.</span><span class="n">MeV</span><span class="p">,</span>
                           <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">UNITS</span><span class="o">.</span><span class="n">MeV</span><span class="p">,</span>
                           <span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">a</span><span class="p">,</span>
                           <span class="n">dx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dx</span> <span class="o">/</span> <span class="n">UNITS</span><span class="o">.</span><span class="n">MeV</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-30" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-30'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">total_energy_density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">particle</span><span class="o">.</span><span class="n">energy_density</span><span class="p">()</span> <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">)</span>

</pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
  </div>
</body>
